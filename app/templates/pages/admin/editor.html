{% extends "base.html" %}
<!--
=============================================================================
POST EDITOR TEMPLATE
=============================================================================
Purpose: Create/edit blog posts with markdown support.

Features:
- Title input
- Markdown content textarea
- Optional excerpt
- Publish toggle
- Save feedback
=============================================================================
-->

{% block title %}{{ action }} Post — {{ site_name }}{% endblock %}

{% block content %}
<div class="container">
    <header class="admin-header">
        <h1>{{ action }} Post</h1>
        <a href="/admin" class="btn btn-secondary">← Back to Dashboard</a>
    </header>

    {% if success %}
    <div class="alert alert-success">
        Post saved successfully!
    </div>
    {% endif %}

    {% if error %}
    <div class="alert alert-error">
        {{ error }}
    </div>
    {% endif %}

    <form 
        method="POST" 
        action="{% if post %}/admin/posts/{{ post.id }}{% else %}/admin/posts{% endif %}"
    >
        <!-- Title -->
        <div class="form-group">
            <label for="title" class="form-label">Title</label>
            <input 
                type="text" 
                id="title" 
                name="title" 
                class="form-input"
                value="{{ post.title if post else '' }}"
                required
                placeholder="Enter post title..."
            >
        </div>

        <!-- Content (Markdown) -->
        <div class="form-group">
            <label for="content" class="form-label">Content (Markdown)</label>
            <textarea 
                id="content" 
                name="content" 
                class="form-textarea"
                required
                placeholder="Write your post in Markdown..."
            >{{ post.content if post else '' }}</textarea>
            <div class="form-hint" style="margin-top: var(--space-4); padding: var(--space-4); background: var(--color-bg-secondary); border-radius: var(--border-radius);">
                <strong style="color: var(--color-text);">Markdown Cheatsheet:</strong><br><br>
                <code># Heading 1</code> &nbsp; <code>## Heading 2</code> &nbsp; <code>### Heading 3</code><br><br>
                <code>**bold**</code> &nbsp; <code>*italic*</code> &nbsp; <code>`inline code`</code><br><br>
                <code>- bullet list</code> &nbsp; <code>1. numbered list</code><br><br>
                <code>[link text](https://url.com)</code><br><br>
                <strong style="color: var(--color-green);">Images & GIFs:</strong><br>
                <code>![alt text](https://example.com/image.png)</code><br>
                <code>![demo](https://example.com/animation.gif)</code><br><br>
                <strong style="color: var(--color-accent);">Code Blocks:</strong><br>
                <code>```python</code><br>
                <code>def hello():</code><br>
                <code>&nbsp;&nbsp;&nbsp;&nbsp;print("Hello!")</code><br>
                <code>```</code><br><br>
                <span style="color: var(--color-text-muted);">Supported languages: python, javascript, sql, bash, html, css, json, etc.</span>
            </div>
        </div>

        <!-- Excerpt -->
        <div class="form-group">
            <label for="excerpt" class="form-label">Excerpt (Optional)</label>
            <input 
                type="text" 
                id="excerpt" 
                name="excerpt" 
                class="form-input"
                value="{{ post.excerpt if post else '' }}"
                placeholder="Short preview text for listings..."
                maxlength="500"
            >
            <p class="form-hint">
                If left empty, the first part of content will be used.
            </p>
        </div>

        <!-- Published -->
        <div class="form-group">
            <label class="form-checkbox">
                <input 
                    type="checkbox" 
                    name="published" 
                    {% if post and post.published %}checked{% endif %}
                >
                <span>Published (visible to public)</span>
            </label>
        </div>

        <!-- Actions -->
        <div class="btn-group">
            <button type="submit" class="btn btn-primary">
                {{ 'Update' if post else 'Create' }} Post
            </button>
            {% if post %}
            <a href="/blog/{{ post.slug }}" class="btn btn-secondary">
                Preview
            </a>
            {% endif %}
            <a href="/admin" class="btn btn-secondary">Cancel</a>
        </div>
    </form>

    {% if post %}
    <!-- Danger Zone -->
    <section class="section mt-8" style="border-top: 1px solid var(--color-border); padding-top: var(--space-8);">
        <h3 style="color: var(--color-accent);">Danger Zone</h3>
        <p class="text-muted mb-4">
            Deleting a post is permanent and cannot be undone.
        </p>
        <form action="/admin/posts/{{ post.id }}/delete" method="POST">
            <button 
                type="submit" 
                class="btn btn-danger"
                data-confirm="Are you sure you want to delete '{{ post.title }}'? This cannot be undone."
            >
                Delete This Post
            </button>
        </form>
    </section>
    {% endif %}
</div>
{% endblock %}
